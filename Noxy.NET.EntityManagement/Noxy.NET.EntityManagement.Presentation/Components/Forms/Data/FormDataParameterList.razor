@inherits BaseRequestForm<RequestSchemaParameterList, ResponseSchemaParameterList>

<div @attributes="AdditionalAttributes" class="@CssClass">
    <WebForm T="RequestSchemaParameterList" Context="Context" OnSubmit="ForwardSubmit">
        <InputGroupText DisplayName="@GetDisplayName(nameof(Model.Search))" Description="@GetDescription(nameof(Model.Search))"
                        @bind-Value="Context.Model.Search"/>

        <InputGroupSelect OptionList="ListIsSystemDefinedKey" DisplayName="@GetDisplayName(nameof(Model.IsSystemDefined))" Description="@GetDescription(nameof(Model.IsSystemDefined))"
                          Name="@nameof(Model.IsSystemDefined)" @bind-Value:get="GetIsSystemDefined()" @bind-Value:set="SetIsSystemDefined">
            <span>@TextService.Get(_collectionIsSystemDefined[context])</span>
        </InputGroupSelect>

        <InputGroupSelect OptionList="ListIsApprovalRequiredKey" DisplayName="@GetDisplayName(nameof(Model.IsApprovalRequired))" Description="@GetDescription(nameof(Model.IsApprovalRequired))"
                          Name="@nameof(Model.IsApprovalRequired)" @bind-Value:get="GetIsApprovalRequired()" @bind-Value:set="SetIsApprovalRequired">
            <span>@TextService.Get(_collectionIsApprovalRequired[context])</span>
        </InputGroupSelect>

        <InputGroupCheckboxSet OptionList="ListTypeKey" DisplayName="@GetDisplayName(nameof(Model.ParameterType))" Description="@GetDescription(nameof(Model.ParameterType))"
                               @bind-Value:get="GetParameterType()" @bind-Value:set="SetParameterType">
            <span>@TextService.Get(_collectionType[context])</span>
        </InputGroupCheckboxSet>

        @ChildContent
    </WebForm>
</div>

@code {

    private readonly Dictionary<int, string> _collectionIsSystemDefined = [];
    private readonly Dictionary<int, string> _collectionIsApprovalRequired = [];
    private readonly Dictionary<string, string> _collectionType = [];

    private IEnumerable<int> ListIsSystemDefinedKey => _collectionIsSystemDefined.Select(x => x.Key);
    private IEnumerable<int> ListIsApprovalRequiredKey => _collectionIsApprovalRequired.Select(x => x.Key);
    private IEnumerable<string> ListTypeKey => _collectionType.Select(x => x.Key);

    protected override async Task OnAfterFirstRenderAsync()
    {
        await base.OnAfterFirstRenderAsync();

        _collectionIsSystemDefined[-1] = TextConstants.ValueIsSystemDefinedNeutral;
        _collectionIsSystemDefined[0] = TextConstants.ValueIsSystemDefinedYes;
        _collectionIsSystemDefined[1] = TextConstants.ValueIsSystemDefinedNo;

        _collectionIsApprovalRequired[-1] = TextConstants.ValueIsApprovalRequiredNeutral;
        _collectionIsApprovalRequired[0] = TextConstants.ValueIsApprovalRequiredYes;
        _collectionIsApprovalRequired[1] = TextConstants.ValueIsApprovalRequiredNo;

        _collectionType[nameof(EntitySchemaParameterStyle)] = TextConstants.LabelParameterStyle;
        _collectionType[nameof(EntitySchemaParameterSystem)] = TextConstants.LabelParameterSystem;
        _collectionType[nameof(EntitySchemaParameterText)] = TextConstants.LabelParameterText;
    }

    private int GetIsSystemDefined()
    {
        return Model.IsSystemDefined switch
        {
            true => 1,
            false => 0,
            _ => -1
        };
    }

    private void SetIsSystemDefined(int value)
    {
        Model.IsSystemDefined = value == -1 ? null : value == 1;
    }

    private int GetIsApprovalRequired()
    {
        return Model.IsApprovalRequired switch
        {
            true => 1,
            false => 0,
            _ => -1
        };
    }

    private void SetIsApprovalRequired(int value)
    {
        Model.IsApprovalRequired = value == -1 ? null : value == 1;
    }

    private List<string> GetParameterType()
    {
        return Model.ParameterType ?? [];
    }

    private void SetParameterType(List<string>? value)
    {
        Model.ParameterType = value;
    }

    protected override WebFormContext<RequestSchemaParameterList> CreateContext()
    {
        return new(new());
    }

}
