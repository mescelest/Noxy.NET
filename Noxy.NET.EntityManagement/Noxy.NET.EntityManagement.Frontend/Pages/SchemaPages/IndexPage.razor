@page "/Schema"
@inject APIHttpClient APIHttpClient
@inject TextService TextService
@inherits PageComponent

<PageTitle>Home</PageTitle>

<PageLayout>
    <SidebarRightLayout>
        <Sidebar>
            <FormSchema OnChange="LoadData"/>
        </Sidebar>
        <Content>
            <TemplateGridList List="_data">
                <SchemaPanel Schema="@context" OnSchemaChange="OnSchemaPanelSchemaChange"/>
            </TemplateGridList>
        </Content>
    </SidebarRightLayout>
</PageLayout>

@code {

    private EntitySchema[] _data = [];

    protected override async Task OnFirstRenderAsync()
    {
        await base.OnFirstRenderAsync();

        await LoadData();
        await TextService.Resolve();
    }

    private async Task OnSchemaPanelSchemaChange()
    {
        await WithPageLoading(LoadData);
    }

    private async Task LoadData()
    {
        _data = await APIHttpClient.SendRequest<EntitySchema[]>(HttpMethod.Get, "Template/Schema");
    }

}
