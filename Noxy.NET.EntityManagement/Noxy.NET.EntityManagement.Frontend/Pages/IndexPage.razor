@page "/"
@inject APIHttpClient APIHttpClient
@inject TextService TextService
@inject UserAuthenticationStateProvider UserAuthenticationStateProvider
@inherits PageComponent

<PageTitle>Home</PageTitle>

<AuthorizeLayout>
    <PageLayout>
        @foreach (ViewModelSchemaContext item in _listContext)
        {
            <h2>@item.Title</h2>
            <span>@item.Description</span>
            <NavLink href="@GetLink(item.SchemaIdentifier)">@TextService.Get(TextConstants.LinkNavigationSchema)</NavLink>
        }

        <div>
            <InputElementSortable Options="Options" @bind-Value="Values">
                <span>@context</span>
            </InputElementSortable>
        </div>

    </PageLayout>
</AuthorizeLayout>

@code {

    private ViewModelSchemaContext[] _listContext = [];

    private List<string> Values = ["A", "B", "C", "D", "E"];

    private SortableOptions Options = new SortableOptions
    {
            Group = new SortableOptionsGroup
            {
                    Name = "Test",
            },
    };

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);
        if (!firstRender) return;

        await WithLoading(TextService.Resolve);
        if ((await UserAuthenticationStateProvider.GetAuthenticationStateAsync()).User.Identity?.IsAuthenticated ?? true) return;
        await WithLoading(LoadData);
    }

    private async Task UpdateText()
    {
        await TextService.Resolve();
    }

    private async Task LoadData()
    {
        _listContext = await APIHttpClient.SendRequest<ViewModelSchemaContext[]>(HttpMethod.Get, "Data/Context");
    }

    private static string GetLink(string identifier)
    {
        return $"/Context/{identifier}";
    }

}
